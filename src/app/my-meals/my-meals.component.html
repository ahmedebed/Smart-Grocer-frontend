<div class="page">

  <div class="search-bar">
    <input
      type="text"
      placeholder="Search by name or category"
      [(ngModel)]="searchTerm"
      (keyup.enter)="search()"
    />

    <button class="btn primary" (click)="search()">
      Search
    </button>

    <button class="btn ghost" (click)="reset()">
      Remove
    </button>
  </div>

  <!-- Table -->
  <div class="card">
    <table>
      <thead>
        <tr>
          <th>Image</th>
          <th>Name</th>
          <th>Category</th>
          <th>Area</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>

      <tbody>

        <tr *ngFor="let meal of meals; let i = index">

          <td>
            <img [src]="meal.thumbnail" alt="meal" />
          </td>

          <td>{{ meal.name }}</td>
          <td>{{ meal.category }}</td>
          <td>{{ meal.area }}</td>

          <!-- Status -->
          <td class="status">
            <span *ngIf="meal.approved" class="status-icon approved">‚úî</span>
            <span *ngIf="!meal.approved" class="status-icon not-approved">‚úñ</span>
          </td>

          <!-- Actions -->
          <td class="actions">
            <button
              class="dots-btn"
              (click)="toggleMenu(i, $event)">
              ‚ãÆ
            </button>

            <div class="menu" *ngIf="openMenuIndex === i">

              <button
                class="menu-item details"
                (click)="showDetails(meal.id)">
                üëÅ Show Details
              </button>

              <button
                class="menu-item approve"
                (click)="approveMeal(meal.externalId); $event.stopPropagation()">
                ‚úî Approve
              </button>

              <button
                class="menu-item delete"
                (click)="openDelete(meal.id); $event.stopPropagation()">
                üóë Delete
              </button>

            </div>
          </td>

        </tr>

        <tr *ngIf="meals.length === 0">
          <td colspan="6" class="empty">
            No meals found
          </td>
        </tr>

      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="pagination" *ngIf="totalPages > 1">
    <button
      *ngFor="let p of totalPagesArray; let i = index"
      [class.active]="page === i"
      (click)="changePage(i)">
      {{ i + 1 }}
    </button>
  </div>

</div>

<app-toast
  [message]="toastMessage"
  [type]="toastType">
</app-toast>

<!-- Delete Popup -->
<div class="overlay" *ngIf="mealToDelete !== null" (click)="cancelDelete()">
  <div class="delete-card" (click)="$event.stopPropagation()">

    <h3>Delete Meal</h3>
    <p>
      Are you sure you want to delete this meal?
      <br />
      This action cannot be undone.
    </p>

    <div class="popup-actions">
      <button class="cancel" (click)="cancelDelete()">
        Cancel
      </button>

      <button class="delete" (click)="confirmDelete()">
        Delete
      </button>
    </div>

  </div>
</div>
